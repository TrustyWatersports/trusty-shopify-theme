<div class="container" style="padding: 40px 20px;">
  
  <!-- Collection Header -->
  <div style="text-align: center; margin-bottom: 50px;">
    <h1 style="font-size: 42px; color: var(--ocean-deep); margin-bottom: 15px;">
      {{ collection.title }}
    </h1>
    {% if collection.description != blank %}
      <div style="font-size: 18px; color: var(--gray-medium); max-width: 800px; margin: 0 auto;">
        {{ collection.description }}
      </div>
    {% endif %}
  </div>

  <!-- Filters and Sorting -->
  <div style="background: var(--gray-light); padding: 25px; border-radius: 12px; margin-bottom: 40px;">
    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px;">
      
      <!-- Type Filter -->
      <div>
        <label style="display: block; font-weight: 600; margin-bottom: 8px; color: var(--text-dark);">Type</label>
        <select id="type-filter" style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 6px; background: white;">
          <option value="">All Types</option>
          <option value="fishing">Fishing</option>
          <option value="pedal">Pedal Drive</option>
          <option value="recreational">Recreational</option>
          <option value="touring">Touring</option>
          <option value="tandem">Tandem</option>
        </select>
      </div>

      <!-- Propulsion Filter -->
      <div>
        <label style="display: block; font-weight: 600; margin-bottom: 8px; color: var(--text-dark);">Propulsion</label>
        <select id="propulsion-filter" style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 6px; background: white;">
          <option value="">All</option>
          <option value="paddle">Paddle</option>
          <option value="pedal">Pedal Drive</option>
          <option value="motor">Motor Ready</option>
        </select>
      </div>

      <!-- Price Range -->
      <div>
        <label style="display: block; font-weight: 600; margin-bottom: 8px; color: var(--text-dark);">Price Range</label>
        <select id="price-filter" style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 6px; background: white;">
          <option value="">All Prices</option>
          <option value="0-1000">Under $1,000</option>
          <option value="1000-2000">$1,000 - $2,000</option>
          <option value="2000-3000">$2,000 - $3,000</option>
          <option value="3000-5000">$3,000 - $5,000</option>
          <option value="5000-999999">$5,000+</option>
        </select>
      </div>

      <!-- Sort -->
      <div>
        <label style="display: block; font-weight: 600; margin-bottom: 8px; color: var(--text-dark);">Sort By</label>
        <select id="sort" style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 6px; background: white;" onchange="window.location.href=this.value">
          <option value="?sort_by=manual">Featured</option>
          <option value="?sort_by=price-ascending" {% if collection.sort_by == 'price-ascending' %}selected{% endif %}>Price: Low to High</option>
          <option value="?sort_by=price-descending" {% if collection.sort_by == 'price-descending' %}selected{% endif %}>Price: High to Low</option>
          <option value="?sort_by=title-ascending" {% if collection.sort_by == 'title-ascending' %}selected{% endif %}>A-Z</option>
          <option value="?sort_by=created-descending" {% if collection.sort_by == 'created-descending' %}selected{% endif %}>Newest</option>
        </select>
      </div>
    </div>

    <!-- Active Filters Display -->
    <div id="active-filters" style="margin-top: 20px; display: flex; gap: 10px; flex-wrap: wrap;"></div>
  </div>

  <!-- Product Count -->
  <div style="margin-bottom: 30px; color: var(--gray-medium);">
    Showing <strong>{{ collection.products.size }}</strong> products
  </div>

  <!-- Products Grid -->
  <div id="products-grid" style="display: grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); gap: 30px; margin-bottom: 60px;">
    {% for product in collection.products %}
      <div class="product-card" 
           data-type="{{ product.type | downcase }}" 
           data-price="{{ product.price | divided_by: 100 }}"
           style="background: var(--white); border-radius: 12px; overflow: hidden; box-shadow: 0 4px 12px rgba(0,0,0,0.08); transition: transform 0.3s, box-shadow 0.3s; position: relative;">
        
        <!-- Stock Badge -->
        {% if product.available %}
          {% assign stock_level = product.variants.first.inventory_quantity | default: 0 %}
          {% if stock_level > 0 and stock_level <= 3 %}
            <div style="position: absolute; top: 10px; right: 10px; background: var(--sunrise); color: white; padding: 5px 12px; border-radius: 20px; font-size: 12px; font-weight: 600; z-index: 1;">
              Only {{ stock_level }} left!
            </div>
          {% elsif stock_level > 3 %}
            <div style="position: absolute; top: 10px; right: 10px; background: var(--rigging-accent); color: white; padding: 5px 12px; border-radius: 20px; font-size: 12px; font-weight: 600; z-index: 1;">
              In Stock
            </div>
          {% endif %}
        {% else %}
          <div style="position: absolute; top: 10px; right: 10px; background: var(--gray-medium); color: white; padding: 5px 12px; border-radius: 20px; font-size: 12px; font-weight: 600; z-index: 1;">
            Sold Out
          </div>
        {% endif %}

        <a href="{{ product.url }}" style="text-decoration: none; color: inherit;">
          <!-- Product Image -->
          {% if product.featured_image %}
            <img src="{{ product.featured_image | image_url: width: 400 }}" 
                 alt="{{ product.title }}" 
                 style="width: 100%; height: 240px; object-fit: cover;">
          {% else %}
            <div style="width: 100%; height: 240px; background: var(--gray-light); display: flex; align-items: center; justify-content: center; color: var(--gray-medium); font-size: 14px;">
              No image available
            </div>
          {% endif %}

          <div style="padding: 20px;">
            <!-- Brand/Type Tag -->
            {% if product.vendor %}
              <div style="color: var(--ocean-medium); font-size: 12px; font-weight: 600; text-transform: uppercase; margin-bottom: 8px;">
                {{ product.vendor }}
              </div>
            {% endif %}

            <!-- Product Title -->
            <h3 style="font-size: 18px; margin-bottom: 12px; color: var(--ocean-deep); line-height: 1.3;">
              {{ product.title }}
            </h3>

            <!-- Product Type/Category -->
            {% if product.type %}
              <div style="font-size: 13px; color: var(--gray-medium); margin-bottom: 15px;">
                {{ product.type }}
              </div>
            {% endif %}

            <!-- Price -->
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
              <span style="font-size: 24px; font-weight: 700; color: var(--text-dark);">
                {{ product.price | money }}
              </span>
              {% if product.compare_at_price > product.price %}
                <span style="text-decoration: line-through; color: var(--gray-medium); font-size: 16px;">
                  {{ product.compare_at_price | money }}
                </span>
              {% endif %}
            </div>

            <!-- Key Features (from first 3 bullet points in description) -->
            {% if product.description != blank %}
              <div style="font-size: 13px; color: var(--gray-medium); margin-bottom: 15px; line-height: 1.6;">
                {{ product.description | strip_html | truncate: 120 }}
              </div>
            {% endif %}

            <!-- Action Buttons -->
            <div style="display: flex; gap: 10px;">
              <a href="{{ product.url }}" class="btn btn-secondary" style="flex: 1; text-align: center; padding: 10px; font-size: 14px; text-decoration: none;">
                View Details
              </a>
              <a href="/pages/custom-rigging?kayak={{ product.handle }}" class="btn btn-primary" style="flex: 1; text-align: center; padding: 10px; font-size: 14px; text-decoration: none;">
                + Custom Rig
              </a>
            </div>
          </div>
        </a>
      </div>
    {% endfor %}
  </div>

  <!-- Pagination -->
  {% if paginate.pages > 1 %}
    <div style="display: flex; justify-content: center; gap: 10px; margin-top: 60px;">
      {% if paginate.previous %}
        <a href="{{ paginate.previous.url }}" class="btn btn-secondary">â† Previous</a>
      {% endif %}
      
      {% for part in paginate.parts %}
        {% if part.is_link %}
          <a href="{{ part.url }}" class="btn btn-secondary">{{ part.title }}</a>
        {% else %}
          <span class="btn btn-primary">{{ part.title }}</span>
        {% endif %}
      {% endfor %}
      
      {% if paginate.next %}
        <a href="{{ paginate.next.url }}" class="btn btn-secondary">Next â†’</a>
      {% endif %}
    </div>
  {% endif %}

</div>

<!-- CTA Banner -->
<div style="background: linear-gradient(135deg, var(--ocean-deep) 0%, var(--ocean-medium) 100%); color: var(--white); padding: 60px 20px; text-align: center; margin-top: 80px;">
  <div class="container">
    <h2 style="font-size: 36px; margin-bottom: 20px;">Can't Decide? We Can Help.</h2>
    <p style="font-size: 18px; margin-bottom: 30px; opacity: 0.95;">
      Visit our showroom to see 60+ kayaks, try before you buy with rentals, or call for expert advice.
    </p>
    <div style="display: flex; gap: 20px; justify-content: center; flex-wrap: wrap;">
      <a href="/pages/showroom" class="btn" style="background: white; color: var(--ocean-deep); font-size: 16px; padding: 14px 28px;">
        Visit Showroom
      </a>
      <a href="/pages/rentals" class="btn btn-secondary" style="font-size: 16px; padding: 14px 28px;">
        Rent First
      </a>
      <a href="/pages/contact" class="btn btn-secondary" style="font-size: 16px; padding: 14px 28px;">
        Get Expert Help
      </a>
    </div>
  </div>
</div>

<script>
  // Simple client-side filtering (you can enhance this or use Shopify's native filtering)
  document.getElementById('type-filter').addEventListener('change', filterProducts);
  document.getElementById('propulsion-filter').addEventListener('change', filterProducts);
  document.getElementById('price-filter').addEventListener('change', filterProducts);

  function filterProducts() {
    const typeFilter = document.getElementById('type-filter').value.toLowerCase();
    const propulsionFilter = document.getElementById('propulsion-filter').value.toLowerCase();
    const priceFilter = document.getElementById('price-filter').value;
    
    const products = document.querySelectorAll('.product-card');
    
    products.forEach(product => {
      const productType = product.dataset.type;
      const productPrice = parseFloat(product.dataset.price);
      
      let showProduct = true;
      
      // Type filter
      if (typeFilter && !productType.includes(typeFilter)) {
        showProduct = false;
      }
      
      // Price filter
      if (priceFilter) {
        const [min, max] = priceFilter.split('-').map(Number);
        if (productPrice < min || productPrice > max) {
          showProduct = false;
        }
      }
      
      product.style.display = showProduct ? 'block' : 'none';
    });
  }

  // Hover effect for product cards
  document.querySelectorAll('.product-card').forEach(card => {
    card.addEventListener('mouseenter', function() {
      this.style.transform = 'translateY(-8px)';
      this.style.boxShadow = '0 8px 24px rgba(0,0,0,0.15)';
    });
    card.addEventListener('mouseleave', function() {
      this.style.transform = 'translateY(0)';
      this.style.boxShadow = '0 4px 12px rgba(0,0,0,0.08)';
    });
  });
</script>

