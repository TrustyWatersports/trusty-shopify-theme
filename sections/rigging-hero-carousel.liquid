{% comment %}
Rigging Hero Carousel (OS2)
- Blocks = slides (image or video)
- Fade transition
{% endcomment %}

<section class="rig-hero" data-interval="{{ section.settings.interval_ms }}">
  <div class="rig-hero__slides">
    {% for block in section.blocks %}
      <div class="rig-hero__slide{% if forloop.first %} is-active{% endif %}" {{ block.shopify_attributes }}>
        {% case block.type %}
          {% when 'image' %}
            {% if block.settings.image != blank %}
              <div class="rig-hero__bg" style="background-image:url('{{ block.settings.image | image_url: width: 2400 }}');"></div>
            {% else %}
              <div class="rig-hero__bg rig-hero__bg--fallback"></div>
            {% endif %}

          {% when 'video' %}
            {% if block.settings.video != blank %}
              {{ block.settings.video | video_tag: autoplay: true, loop: true, muted: true, controls: false, playsinline: true, class: 'rig-hero__video' }}
            {% elsif block.settings.video_url != blank %}
              {%- assign url = block.settings.video_url -%}
              {%- if url.type == 'youtube' -%}
                {%- assign yid = url.id -%}
                <iframe
                  class="rig-hero__iframe"
                  src="https://www.youtube.com/embed/{{ yid }}?autoplay=1&mute=1&loop=1&playlist={{ yid }}&controls=0&rel=0&playsinline=1"
                  title="Hero video"
                  frameborder="0"
                  allow="autoplay; encrypted-media; picture-in-picture"
                  allowfullscreen>
                </iframe>
              {%- elsif url.type == 'vimeo' -%}
                {%- assign vid = url.id -%}
                <iframe
                  class="rig-hero__iframe"
                  src="https://player.vimeo.com/video/{{ vid }}?autoplay=1&muted=1&loop=1&background=1"
                  title="Hero video"
                  frameborder="0"
                  allow="autoplay; fullscreen; picture-in-picture"
                  allowfullscreen>
                </iframe>
              {%- endif -%}
            {% else %}
              <div class="rig-hero__bg rig-hero__bg--fallback"></div>
            {% endif %}
        {% endcase %}
      </div>
    {% endfor %}
  </div>

  <div class="rig-hero__overlay" style="opacity: {{ section.settings.overlay_opacity | divided_by: 100.0 }};"></div>

  <div class="rig-hero__inner">
    {% if section.settings.badge_text != blank %}
      <div class="rig-hero__badge">{{ section.settings.badge_text }}</div>
    {% endif %}

    <h1 class="rig-hero__title">
      {{ section.settings.h1 }}
      <span class="rig-hero__highlight">{{ section.settings.h2 }}</span>
      {{ section.settings.h3 }}
    </h1>

    {% if section.settings.description != blank %}
      <p class="rig-hero__desc">{{ section.settings.description }}</p>
    {% endif %}

    <div class="rig-hero__buttons">
      {% if section.settings.primary_text != blank and section.settings.primary_link != blank %}
        <a class="trusty-btn trusty-btn--primary" href="{{ section.settings.primary_link }}">{{ section.settings.primary_text }}</a>
      {% endif %}
      {% if section.settings.secondary_text != blank and section.settings.secondary_link != blank %}
        <a class="trusty-btn trusty-btn--secondary" href="{{ section.settings.secondary_link }}">{{ section.settings.secondary_text }}</a>
      {% endif %}
    </div>
  </div>
</section>

<style>
  .rig-hero{position:relative;min-height:520px;overflow:hidden;background:#0A4B78}
  .rig-hero__slides{position:absolute;inset:0}
  .rig-hero__slide{position:absolute;inset:0;opacity:0;transition:opacity 750ms ease}
  .rig-hero__slide.is-active{opacity:1}
  .rig-hero__bg{position:absolute;inset:0;background-size:cover;background-position:center;background-repeat:no-repeat;transform:scale(1.02)}
  .rig-hero__bg--fallback{background:linear-gradient(135deg,#1B3A52,#0A4B78)}
  .rig-hero__video,.rig-hero__iframe{position:absolute;inset:0;width:100%;height:100%;object-fit:cover;transform:scale(1.02)}
  .rig-hero__iframe{border:0}
  .rig-hero__overlay{position:absolute;inset:0;background:linear-gradient(135deg,rgba(27,58,82,1),rgba(10,75,120,1));pointer-events:none}
  .rig-hero__inner{position:relative;z-index:2;max-width:1400px;margin:0 auto;padding:72px 20px;color:#fff}
  .rig-hero__badge{display:inline-block;background:#00A86B;color:#fff;padding:8px 18px;border-radius:999px;font-size:13px;font-weight:800;text-transform:uppercase;letter-spacing:.3px;margin-bottom:14px}
  .rig-hero__title{font-size:clamp(34px,4.2vw,58px);line-height:1.08;font-weight:900;margin:0 0 14px;max-width:900px}
  .rig-hero__highlight{color:#FF6B35}
  .rig-hero__desc{font-size:18px;line-height:1.6;opacity:.95;max-width:820px;margin:0 0 26px}
  .rig-hero__buttons{display:flex;gap:12px;flex-wrap:wrap}
  .trusty-btn{display:inline-block;padding:14px 22px;border-radius:8px;font-weight:800;text-decoration:none;transition:all .3s}
  .trusty-btn--primary{background:#00A86B;color:#fff}
  .trusty-btn--primary:hover{background:#008c59;transform:translateY(-2px)}
  .trusty-btn--secondary{border:2px solid #fff;color:#fff;background:transparent}
  .trusty-btn--secondary:hover{background:rgba(255,255,255,.1)}
  @media(max-width:768px){.rig-hero{min-height:460px}.rig-hero__inner{padding:56px 16px}}
</style>

<script>
  (function(){
    const hero = document.currentScript.previousElementSibling?.previousElementSibling?.previousElementSibling;
    if(!hero || !hero.classList.contains('rig-hero')) return;
    const slides = Array.from(hero.querySelectorAll('.rig-hero__slide'));
    if(slides.length <= 1) return;

    const interval = parseInt(hero.getAttribute('data-interval') || '5000', 10);
    let i = 0;

    function activate(idx){
      slides.forEach((s,n)=>s.classList.toggle('is-active', n===idx));
      slides.forEach((s,n)=>{
        const v = s.querySelector('video');
        if(!v) return;
        try { (n===idx) ? v.play() : v.pause(); } catch(e){}
      });
    }

    setInterval(()=>{ i=(i+1)%slides.length; activate(i); }, interval);
  })();
</script>

{% schema %}
{
  "name": "Rigging Hero",
  "settings": [
    { "type": "text", "id": "badge_text", "label": "Badge", "default": "âš¡ Custom Rigging" },
    { "type": "text", "id": "h1", "label": "Heading 1", "default": "Custom Kayak" },
    { "type": "text", "id": "h2", "label": "Heading 2", "default": "Rigging" },
    { "type": "text", "id": "h3", "label": "Heading 3", "default": "Done Right" },
    { "type": "textarea", "id": "description", "label": "Description", "default": "Crystal Coast experts. Turnkey builds from mild to wild." },
    { "type": "range", "id": "overlay_opacity", "label": "Overlay", "min": 0, "max": 90, "step": 5, "default": 35 },
    { "type": "range", "id": "interval_ms", "label": "Interval (ms)", "min": 2000, "max": 9000, "step": 500, "default": 5000 },
    { "type": "text", "id": "primary_text", "label": "Primary text", "default": "Browse Packages" },
    { "type": "url", "id": "primary_link", "label": "Primary link" },
    { "type": "text", "id": "secondary_text", "label": "Secondary text", "default": "Get a Quote" },
    { "type": "url", "id": "secondary_link", "label": "Secondary link" }
  ],
  "blocks": [
    {
      "type": "image",
      "name": "Image",
      "settings": [
        { "type": "image_picker", "id": "image", "label": "Slide image" }
      ]
    },
    {
      "type": "video",
      "name": "Video",
      "settings": [
        { "type": "video", "id": "video", "label": "Shopify video" },
        { "type": "video_url", "id": "video_url", "label": "YouTube/Vimeo", "accept": ["youtube", "vimeo"] }
      ]
    }
  ],
  "presets": [
    {
      "name": "Rigging Hero",
      "blocks": [
        { "type": "image" },
        { "type": "image" }
      ]
    }
  ]
}
{% endschema %}
