<!-- Gallery Header -->
<section style="padding: 60px 20px 30px; text-align: center;">
  <div style="max-width: 800px; margin: 0 auto;">
    {% if section.settings.gallery_icon != blank %}
      <div style="font-size: 3rem; margin-bottom: 16px;">{{ section.settings.gallery_icon }}</div>
    {% endif %}
    <h1 style="font-size: 2.5rem; font-weight: 800; color: #0A4B78; margin-bottom: 12px;">{{ section.settings.gallery_title }}</h1>
    {% if section.settings.gallery_subtitle != blank %}
      <p style="font-size: 1.1rem; color: #666; max-width: 600px; margin: 0 auto;">{{ section.settings.gallery_subtitle }}</p>
    {% endif %}
  </div>
</section>

<!-- Filter Tabs -->
{% assign categories = "" %}
{% for block in section.blocks %}
  {% if block.settings.category != blank %}
    {% unless categories contains block.settings.category %}
      {% assign categories = categories | append: block.settings.category | append: "|" %}
    {% endunless %}
  {% endif %}
{% endfor %}

{% if section.settings.show_filters and categories != "" %}
  {% assign cat_array = categories | split: "|" %}
  <div style="padding: 0 20px 30px; text-align: center;">
    <button onclick="filterGallery('all')" id="filter-all" style="margin: 4px; padding: 8px 20px; border-radius: 20px; border: 2px solid #0A4B78; background: #0A4B78; color: white; cursor: pointer; font-weight: 600; font-size: 14px;">All Photos</button>
    {% for cat in cat_array %}
      {% if cat != "" %}
        <button onclick="filterGallery('{{ cat | handleize }}')" id="filter-{{ cat | handleize }}" style="margin: 4px; padding: 8px 20px; border-radius: 20px; border: 2px solid #0A4B78; background: white; color: #0A4B78; cursor: pointer; font-weight: 600; font-size: 14px;">{{ cat }}</button>
      {% endif %}
    {% endfor %}
  </div>
{% endif %}

<!-- Gallery Grid -->
<section style="padding: 0 20px 60px;">
  <div id="gallery-grid" style="max-width: 1200px; margin: 0 auto; columns: {{ section.settings.columns }} 280px; gap: 16px;">
    {% for block in section.blocks %}
      {% if block.settings.photo != blank %}
        <div
          class="gallery-item"
          data-category="{{ block.settings.category | handleize }}"
          style="break-inside: avoid; margin-bottom: 16px; border-radius: 10px; overflow: hidden; position: relative; cursor: pointer; box-shadow: 0 2px 8px rgba(0,0,0,0.1);"
          onclick="openLightbox('{{ block.settings.photo | img_url: '2048x' }}', '{{ block.settings.caption }}')"
          {{ block.shopify_attributes }}
        >
          <img src="{{ block.settings.photo | img_url: '800x' }}" alt="{{ block.settings.caption | default: 'Trusty Sail & Paddle' }}" loading="lazy" style="width: 100%; display: block;">
        </div>
      {% endif %}
    {% endfor %}
  </div>

  {% if section.blocks.size == 0 %}
    <div style="text-align: center; padding: 80px 20px; color: #999;">
      <div style="font-size: 3rem; margin-bottom: 16px;">ðŸ“·</div>
      <p style="font-size: 1.1rem;">Add photos using the "Add block" button in the customizer.</p>
    </div>
  {% endif %}
</section>

<!-- Lightbox -->
<div id="gallery-lightbox" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.92); z-index: 9999; align-items: center; justify-content: center; flex-direction: column; padding: 20px;">
  <button onclick="closeLightbox()" style="position: absolute; top: 20px; right: 24px; background: none; border: none; color: white; font-size: 36px; cursor: pointer;">&times;</button>
  <img id="lightbox-img" src="" alt="" style="max-width: 90vw; max-height: 80vh; border-radius: 8px; object-fit: contain;">
  <p id="lightbox-caption" style="color: white; margin-top: 12px; font-size: 15px; text-align: center; opacity: 0.85;"></p>
</div>

<script>
  function openLightbox(src, caption) {
    var lb = document.getElementById('gallery-lightbox');
    document.getElementById('lightbox-img').src = src;
    document.getElementById('lightbox-caption').textContent = caption || '';
    lb.style.display = 'flex';
    document.body.style.overflow = 'hidden';
  }
  function closeLightbox() {
    document.getElementById('gallery-lightbox').style.display = 'none';
    document.body.style.overflow = '';
  }
  document.getElementById('gallery-lightbox').addEventListener('click', function(e) {
    if (e.target === this) closeLightbox();
  });
  document.addEventListener('keydown', function(e) {
    if (e.key === 'Escape') closeLightbox();
  });
  function filterGallery(cat) {
    var items = document.querySelectorAll('.gallery-item');
    items.forEach(function(item) {
      item.style.display = (cat === 'all' || item.dataset.category === cat) ? 'block' : 'none';
    });
    document.querySelectorAll('[id^="filter-"]').forEach(function(btn) {
      btn.style.background = 'white'; btn.style.color = '#0A4B78';
    });
    var active = document.getElementById('filter-' + cat);
    if (active) { active.style.background = '#0A4B78'; active.style.color = 'white'; }
  }
</script>

{% schema %}
{
  "name": "Photo Gallery",
  "settings": [
    { "type": "text", "id": "gallery_icon", "label": "Icon (emoji)", "default": "ðŸ“·" },
    { "type": "text", "id": "gallery_title", "label": "Gallery Title", "default": "Photo Gallery" },
    { "type": "textarea", "id": "gallery_subtitle", "label": "Subtitle" },
    { "type": "range", "id": "columns", "label": "Columns (desktop)", "min": 2, "max": 4, "step": 1, "default": 3 },
    { "type": "checkbox", "id": "show_filters", "label": "Show category filter tabs", "default": true }
  ],
  "blocks": [
    {
      "type": "photo",
      "name": "Photo",
      "settings": [
        { "type": "image_picker", "id": "photo", "label": "Photo" },
        { "type": "text", "id": "caption", "label": "Caption (optional)" },
        {
          "type": "select",
          "id": "category",
          "label": "Category",
          "options": [
            { "value": "Kayak Fishing", "label": "Kayak Fishing" },
            { "value": "Sailing", "label": "Sailing" },
            { "value": "Tours & Programs", "label": "Tours & Programs" },
            { "value": "Crystal Coast", "label": "Crystal Coast" },
            { "value": "Our Team", "label": "Our Team" },
            { "value": "Events", "label": "Events" }
          ],
          "default": "Crystal Coast"
        }
      ]
    }
  ],
  "presets": [{ "name": "Photo Gallery" }]
}
{% endschema %}
