<!-- Top Announcement Bar -->
<div class="top-bar">
  ğŸ£ {{ section.settings.announcement_text }}
</div>

<!-- Quick Access Navigation -->
{%- if section.settings.quick_menu != blank -%}
  {%- assign quick_menu = linklists[section.settings.quick_menu] -%}
  <div class="quick-access">
    <div class="quick-access-content">
      {%- for link in quick_menu.links -%}
        <a href="{{ link.url }}" class="quick-link{% if forloop.first %} primary{% endif %}">
          {{ link.title }}
        </a>
      {%- endfor -%}
    </div>
  </div>
{%- endif -%}

<!-- Main Header -->
<header>
  <div class="header-content">
    <a href="/" class="logo">
      {%- if section.settings.logo != blank -%}
        <img src="{{ section.settings.logo | image_url: width: 200 }}" alt="{{ shop.name }}" style="height: 60px; width: auto;">
      {%- else -%}
        <img src="https://images.squarespace-cdn.com/content/v1/6192794d1d9bc87b9719f93c/d75cec6a-478b-4fff-b3ae-bd24f8e06d8c/LOGO3.jpg?format=300w" alt="{{ shop.name }}" style="height: 60px; width: auto;">
      {%- endif -%}
      <div class="logo-text">
        <span class="trusty">Trusty</span> <span class="sail">Sail & Paddle</span>
      </div>
    </a>

    <button class="hamburger" id="hamburger" aria-label="Toggle menu">
      <span></span>
      <span></span>
      <span></span>
    </button>

    {%- assign main_menu = linklists[section.settings.main_menu] -%}
    <nav id="main-nav">
      <!-- Mobile call buttons at top of drawer -->
      <div class="nav-mobile-calls">
        <a href="tel:252-499-9911" style="display:block; background: var(--sunrise); color: white; padding: 12px 20px; text-decoration: none; font-weight: 700; font-size: 14px; text-align: center; margin-bottom: 4px;">ğŸ“ Shop: (252) 499-9911</a>
        <a href="tel:252-515-4866" style="display:block; background: var(--ocean-medium); color: white; padding: 12px 20px; text-decoration: none; font-weight: 700; font-size: 14px; text-align: center;">ğŸ“ Waterfront: (252) 515-4866</a>
      </div>
      {%- for link in main_menu.links -%}
        {%- if link.links != blank -%}
          <div class="nav-item dropdown">
            <a href="{{ link.url }}">{{ link.title | upcase }} â–¾</a>
            <div class="dropdown-content">
              {%- for child_link in link.links -%}
                <a href="{{ child_link.url }}">{{ child_link.title }}</a>
              {%- endfor -%}
            </div>
          </div>
        {%- else -%}
          <a href="{{ link.url }}">{{ link.title | upcase }}</a>
        {%- endif -%}
      {%- endfor -%}
    </nav>

    <div class="header-actions">
      <!-- Desktop: full phone buttons; Mobile: hidden in favor of nav drawer -->
      <a href="tel:252-499-9911" class="header-phone-btn" style="background: var(--sunrise); color: white; padding: 10px 16px; border-radius: 6px; text-decoration: none; font-weight: 700; font-size: 13px; white-space: nowrap; transition: all 0.3s; margin-right: 10px;">
        <span style="font-size: 10px; opacity: 0.9; display: block; margin-bottom: 2px;">SHOP</span>
        ğŸ“ (252) 499-9911
      </a>
      <a href="tel:252-515-4866" class="header-phone-btn" style="background: var(--ocean-medium); color: white; padding: 10px 16px; border-radius: 6px; text-decoration: none; font-weight: 700; font-size: 13px; white-space: nowrap; transition: all 0.3s;">
        <span style="font-size: 10px; opacity: 0.9; display: block; margin-bottom: 2px;">WATERFRONT</span>
        ğŸ“ (252) 515-4866
      </a>
      <a href="/search" class="header-icon-btn">ğŸ”</a>
      <a href="/account" class="header-icon-btn">ğŸ‘¤</a>
      <a href="/cart" id="cart-icon" class="header-icon-btn">ğŸ›’ <span id="cart-count">{{ cart.item_count }}</span></a>
    </div>
  </div>
</header>

<script>
  fetch('/cart.js')
    .then(r => r.json())
    .then(data => {
      const el = document.getElementById('cart-count');
      if (el) el.textContent = data.item_count;
    });

  const hamburger = document.getElementById('hamburger');
  const nav = document.getElementById('main-nav');
  if (hamburger && nav) {
    hamburger.addEventListener('click', function() {
      hamburger.classList.toggle('active');
      nav.classList.toggle('active');
    });
    document.addEventListener('click', function(e) {
      if (!nav.contains(e.target) && !hamburger.contains(e.target)) {
        hamburger.classList.remove('active');
        nav.classList.remove('active');
      }
    });
    nav.querySelectorAll('.nav-item').forEach(item => {
      const link = item.querySelector('a');
      if (link && link.textContent.includes('â–¾')) {
        link.addEventListener('click', function(e) {
          if (window.innerWidth <= 968) {
            e.preventDefault();
            item.classList.toggle('open');
          }
        });
      }
    });
  }
</script>

{% schema %}
{
  "name": "Header",
  "settings": [
    {
      "type": "text",
      "id": "announcement_text",
      "label": "Announcement bar text",
      "default": "Custom Kayak Rigging Experts | Free Shipping on Rigs $2,500+ | Trusty Sail & Paddle"
    },
    {
      "type": "image_picker",
      "id": "logo",
      "label": "Logo image"
    },
    {
      "type": "link_list",
      "id": "main_menu",
      "label": "Main navigation menu"
    },
    {
      "type": "link_list",
      "id": "quick_menu",
      "label": "Quick access bar menu"
    }
  ]
}
{% endschema %}
