<section class="cr-hero" style="position:relative; overflow:hidden;">
  <div class="cr-hero__media">
    {% if section.blocks.size > 0 %}
      <div class="cr-hero__track" data-cr-hero-track>
        {% for block in section.blocks %}
          {% case block.type %}
            {% when 'image' %}
              <div class="cr-hero__slide" data-cr-hero-slide {{ block.shopify_attributes }}>
                {% if block.settings.image != blank %}
                  <img
                    src="{{ block.settings.image | image_url: width: 2400 }}"
                    alt="{{ block.settings.image.alt | escape }}"
                    loading="lazy"
                    style="width:100%; height:100%; object-fit:cover;"
                  >
                {% else %}
                  <div style="width:100%; height:100%; background:#0A4B78;"></div>
                {% endif %}
              </div>
            {% when 'video' %}
              <div class="cr-hero__slide" data-cr-hero-slide {{ block.shopify_attributes }}>
                {% if block.settings.video_url != blank %}
                  <video
                    autoplay
                    muted
                    loop
                    playsinline
                    preload="metadata"
                    style="width:100%; height:100%; object-fit:cover;"
                    {% if block.settings.poster != blank %}
                      poster="{{ block.settings.poster | image_url: width: 2400 }}"
                    {% endif %}
                  >
                    <source src="{{ block.settings.video_url }}" type="video/mp4">
                  </video>
                {% else %}
                  <div style="width:100%; height:100%; background:#0A4B78;"></div>
                {% endif %}
              </div>
          {% endcase %}
        {% endfor %}
      </div>
    {% else %}
      <div style="position:absolute; inset:0; background:#0A4B78;"></div>
    {% endif %}

    {%- comment -%}
      Overlay: use opacity control so images are not “blue-obscured”
    {%- endcomment -%}
    <div
      class="cr-hero__overlay"
      style="position:absolute; inset:0; background: {{ section.settings.overlay_color }}; opacity: {{ section.settings.overlay_opacity | times: 0.01 }};"
      aria-hidden="true"
    ></div>
  </div>

  <div class="cr-hero__content" style="position:relative; z-index:2; max-width:1400px; margin:0 auto; padding: 60px 20px;">
    {% if section.settings.badge_text != blank %}
      <div style="display:inline-block; background:#00A86B; color:#fff; padding:8px 18px; border-radius:999px; font-weight:800; font-size:12px; letter-spacing:.5px; text-transform:uppercase;">
        {{ section.settings.badge_text }}
      </div>
    {% endif %}

    <h1 style="margin-top:14px; font-size: clamp(34px, 5vw, 56px); line-height:1.05; font-weight: 900; color:#fff; max-width: 900px;">
      {{ section.settings.heading_1 }}
      <span style="color:#FF6B35;">{{ section.settings.heading_highlight }}</span>
      {{ section.settings.heading_3 }}
    </h1>

    {% if section.settings.description != blank %}
      <p style="margin-top:14px; font-size:18px; color:#fff; opacity:.92; max-width: 820px;">
        {{ section.settings.description }}
      </p>
    {% endif %}

    <div style="margin-top:22px; display:flex; gap:14px; flex-wrap:wrap;">
      {% if section.settings.primary_button_text != blank %}
        <a href="{{ section.settings.primary_button_link }}" style="background:#00A86B; color:#fff; text-decoration:none; font-weight:800; padding:14px 22px; border-radius:10px; display:inline-block;">
          {{ section.settings.primary_button_text }}
        </a>
      {% endif %}

      {% if section.settings.secondary_button_text != blank %}
        <a href="{{ section.settings.secondary_button_link }}" style="border:2px solid #fff; color:#fff; text-decoration:none; font-weight:800; padding:12px 20px; border-radius:10px; display:inline-block; background: transparent;">
          {{ section.settings.secondary_button_text }}
        </a>
      {% endif %}
    </div>
  </div>

  {% if section.settings.enable_autoplay and section.blocks.size > 1 %}
    <script>
      (function(){
        const root = document.currentScript.closest('.cr-hero');
        const track = root && root.querySelector('[data-cr-hero-track]');
        const slides = root && root.querySelectorAll('[data-cr-hero-slide]');
        if(!track || !slides || slides.length < 2) return;

        let i = 0;
        const duration = {{ section.settings.autoplay_seconds | default: 6 | times: 1000 }};
        function show(idx){
          track.style.transform = 'translateX(' + (-idx * 100) + '%)';
        }
        track.style.display = 'flex';
        track.style.width = (slides.length * 100) + '%';
        slides.forEach(s => { s.style.flex = '0 0 100%'; s.style.height = '520px'; });
        show(0);

        setInterval(function(){
          i = (i + 1) % slides.length;
          show(i);
        }, duration);

        track.style.transition = 'transform 500ms ease';
      })();
    </script>
  {% endif %}

  <style>
    .cr-hero__media { position:absolute; inset:0; }
    .cr-hero { min-height: 520px; background:#0A4B78; }
    @media (max-width: 768px){ .cr-hero { min-height: 460px; } }
  </style>
</section>

{% schema %}
{
  "name": "Custom Rigging Hero",
  "settings": [
    { "type": "text", "id": "badge_text", "label": "Badge text", "default": "⚡ Custom Rigging Experts" },
    { "type": "text", "id": "heading_1", "label": "Heading part 1", "default": "Tournament-Ready" },
    { "type": "text", "id": "heading_highlight", "label": "Heading highlight", "default": "Rigging" },
    { "type": "text", "id": "heading_3", "label": "Heading part 3", "default": "Done Right" },
    { "type": "textarea", "id": "description", "label": "Description", "default": "Professional rigging by Crystal Coast experts. Turnkey builds from $3k to $13k+ delivered to your door." },

    { "type": "text", "id": "primary_button_text", "label": "Primary button text", "default": "Browse Rigging Packages" },
    { "type": "url", "id": "primary_button_link", "label": "Primary button link" },

    { "type": "text", "id": "secondary_button_text", "label": "Secondary button text", "default": "Build Custom Rig" },
    { "type": "url", "id": "secondary_button_link", "label": "Secondary button link" },

    { "type": "color", "id": "overlay_color", "label": "Overlay color", "default": "#0A4B78" },
    { "type": "range", "id": "overlay_opacity", "min": 0, "max": 90, "step": 1, "unit": "%", "label": "Overlay opacity", "default": 35 },

    { "type": "checkbox", "id": "enable_autoplay", "label": "Autoplay carousel", "default": true },
    { "type": "range", "id": "autoplay_seconds", "min": 3, "max": 12, "step": 1, "unit": "s", "label": "Autoplay interval", "default": 6 }
  ],
  "blocks": [
    { "type": "image", "name": "Image slide", "settings": [
      { "type": "image_picker", "id": "image", "label": "Image" }
    ]},
    { "type": "video", "name": "Video slide (mp4)", "settings": [
      { "type": "text", "id": "video_url", "label": "MP4 URL" },
      { "type": "image_picker", "id": "poster", "label": "Poster image (optional)" }
    ]}
  ],
  "max_blocks": 8,
  "presets": [
    { "name": "Custom Rigging Hero" }
  ]
}
{% endschema %}
